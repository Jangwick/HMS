{% extends "base/subsystem_base.html" %}

{% block title %}Applicant Details - {{ subsystem_name }}{% endblock %}
{% block header_title %}Candidate Profile{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Back Button & Header -->
    <div class="flex items-center justify-between">
        <a href="{{ url_for('hr1.list_applicants') }}" class="flex items-center text-gray-500 hover:text-[#6366F1] transition-colors group">
            <div class="w-10 h-10 rounded-xl bg-white shadow-sm flex items-center justify-center mr-3 group-hover:shadow-md transition-all">
                <i class="bi bi-arrow-left"></i>
            </div>
            <span class="font-bold uppercase tracking-wider text-xs">Back to Pipeline</span>
        </a>
        <div class="flex space-x-3">
            <form action="{{ url_for('hr1.delete_applicant', id=applicant.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this applicant?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="px-6 py-2.5 bg-red-50 text-red-600 font-bold rounded-xl hover:bg-red-100 transition-colors">
                    Delete Candidate
                </button>
            </form>
            {% if applicant.status == 'Offer' or applicant.status == 'Interview' %}
            <button onclick="openModal('handoffModal')" class="px-6 py-2.5 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 shadow-lg transition-all transform hover:-translate-y-0.5">
                Handoff to HR2
            </button>
            {% endif %}
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Primary Info -->
        <div class="lg:col-span-2 space-y-8">
            <div class="bg-white rounded-[2.5rem] shadow-sm border border-gray-100 overflow-hidden">
                <div class="h-32" style="background: linear-gradient(to right, {{ accent_color or '#3B82F6' }}, #1F2937);"></div>
                <div class="px-10 pb-10 -mt-16">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
                        <div class="flex items-end">
                            <div class="w-32 h-32 rounded-[2rem] bg-white p-2 shadow-xl">
                                <div class="w-full h-full rounded-[1.75rem] bg-gray-50 flex items-center justify-center text-4xl font-black" style="color: {{ accent_color or '#3B82F6' }};">
                                    {{ applicant.first_name[0] }}{{ applicant.last_name[0] }}
                                </div>
                            </div>
                            <div class="ml-6 mb-2">
                                <h1 class="text-3xl font-black text-gray-900">{{ applicant.first_name }} {{ applicant.last_name }}</h1>
                                <p class="text-gray-500 font-medium">Applied on {{ applicant.created_at[:10] }} via <span style="color: {{ accent_color or '#3B82F6' }}; font-weight: 700;">{{ applicant.source }}</span></p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="px-4 py-1.5 rounded-full text-sm font-bold 
                                {% if applicant.status == 'Screening' %}bg-blue-50 text-blue-600
                                {% elif applicant.status == 'Interview' %}bg-amber-50 text-amber-600
                                {% elif applicant.status == 'Offer' %}bg-green-50 text-green-600
                                {% elif applicant.status == 'Rejected' %}bg-red-50 text-red-600
                                {% else %}bg-gray-50 text-gray-600{% endif %}">
                                {{ applicant.status }}
                            </span>
                        </div>
                    </div>

                    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-6">
                            <h3 class="text-sm font-black text-gray-400 uppercase tracking-[0.2em]">Contact Information</h3>
                            <div class="space-y-4">
                                <div class="flex items-center p-4 bg-gray-50 rounded-2xl">
                                    <div class="w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm mr-4" style="color: {{ accent_color or '#3B82F6' }};">
                                        <i class="bi bi-envelope-fill"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs font-bold text-gray-400 uppercase">Email Address</p>
                                        <p class="text-gray-900 font-bold">{{ applicant.email }}</p>
                                    </div>
                                </div>
                                <div class="flex items-center p-4 bg-gray-50 rounded-2xl">
                                    <div class="w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm mr-4" style="color: {{ accent_color or '#3B82F6' }};">
                                        <i class="bi bi-telephone-fill"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs font-bold text-gray-400 uppercase">Phone Number</p>
                                        <p class="text-gray-900 font-bold">{{ applicant.phone or 'Not provided' }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <h3 class="text-sm font-black text-gray-400 uppercase tracking-[0.2em]">Quick Actions</h3>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="openModal('statusModal')" class="w-full flex items-center justify-between p-4 bg-white border border-gray-100 rounded-2xl transition-all group text-left" style="--tw-border-opacity: 0.5; --tw-border-color: {{ accent_color or '#3B82F6' }};">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center text-blue-600 mr-4 group-hover:text-white transition-colors" style="background-color: {{ accent_color or '#3B82F6' }}10; color: {{ accent_color or '#3B82F6' }};">
                                            <i class="bi bi-arrow-left-right"></i>
                                        </div>
                                        <span class="font-bold text-gray-700">Change Status</span>
                                    </div>
                                    <i class="bi bi-chevron-right text-gray-300"></i>
                                </button>
                                <a href="{{ url_for('hr1.schedule_interview', applicant_id=applicant.id) }}" class="w-full flex items-center justify-between p-4 bg-white border border-gray-100 rounded-2xl transition-all group text-left">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center text-amber-600 mr-4 group-hover:text-white transition-colors">
                                            <i class="bi bi-calendar-plus"></i>
                                        </div>
                                        <span class="font-bold text-gray-700">Schedule Interview</span>
                                    </div>
                                    <i class="bi bi-chevron-right text-gray-300"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interviews Section -->
            <div class="bg-white rounded-[2.5rem] shadow-sm border border-gray-100 p-10">
                <div class="flex items-center justify-between mb-8">
                    <h3 class="text-xl font-black text-gray-900">Interview History</h3>
                    <span class="px-3 py-1 bg-gray-100 rounded-lg text-xs font-bold text-gray-500">{{ interviews|length }} Record(s)</span>
                </div>
                
                {% if interviews %}
                <div class="space-y-4">
                    {% for interview in interviews %}
                    <div class="p-6 bg-gray-50 rounded-3xl border border-transparent transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center">
                                <div class="w-12 h-12 rounded-2xl bg-white flex items-center justify-center text-2xl shadow-sm mr-4" style="color: {{ accent_color or '#3B82F6' }};">
                                    <i class="bi bi-person-video3"></i>
                                </div>
                                <div>
                                    <p class="font-black text-gray-900">Interview with {{ interview.users.username }}</p>
                                    <p class="text-xs font-bold text-gray-400 uppercase">{{ interview.interview_date }}</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-white rounded-full text-[10px] font-black uppercase border" style="color: {{ accent_color or '#3B82F6' }}; border-color: {{ accent_color or '#3B82F6' }}20;">
                                {{ interview.status }}
                            </span>
                        </div>
                        <div class="pl-16">
                            <p class="text-gray-600 text-sm leading-relaxed">{{ interview.notes or 'No notes provided for this session.' }}</p>
                            <div class="mt-4 flex items-center text-xs font-bold text-gray-400">
                                <i class="bi bi-geo-alt-fill mr-1"></i>
                                {{ interview.location }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="flex flex-col items-center justify-center py-20 bg-gray-50 rounded-3xl border border-dashed border-gray-200">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-gray-300 shadow-sm mb-4 text-2xl">
                        <i class="bi bi-calendar-x"></i>
                    </div>
                    <p class="text-gray-400 font-bold uppercase tracking-widest text-[10px]">No interviews scheduled</p>
                    <a href="{{ url_for('hr1.schedule_interview', applicant_id=applicant.id) }}" class="mt-4 text-[#6366F1] font-bold text-sm hover:underline">Schedule first interview</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Column: Sidebar -->
        <div class="space-y-8">
            <div class="rounded-[2.5rem] shadow-xl p-8 text-white" style="background: linear-gradient(135deg, #1F2937, {{ accent_color or '#3B82F6' }});">
                <h3 class="text-lg font-black mb-6">Status Management</h3>
                <div class="space-y-3">
                    <p class="text-white/60 text-xs font-bold uppercase tracking-wider">Current Pipeline Position</p>
                    <div class="flex flex-col space-y-2">
                        {% set statuses = ['Screening', 'Interview', 'Offer', 'Handoff', 'Rejected'] %}
                        {% for s in statuses %}
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full mr-3 {% if applicant.status == s %}bg-green-400 shadow-[0_0_10px_rgba(74,222,128,0.5)]{% else %}bg-white/10{% endif %}"></div>
                            <span class="text-sm {% if applicant.status == s %}text-white font-black{% else %}text-white/40 font-medium{% endif %}">{{ s }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="mt-10 pt-8 border-t border-white/10">
                    <button onclick="openModal('statusModal')" class="w-full py-4 text-white font-black rounded-2xl transition-all shadow-lg active:scale-95 hover:scale-[1.02]" style="background: linear-gradient(to right, {{ accent_color or '#3B82F6' }}, #1F2937);">
                        Advance Candidate
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-[2.5rem] shadow-sm border border-gray-100 p-8">
                <h3 class="text-sm font-black text-gray-400 uppercase tracking-[0.2em] mb-6">Files & Documents</h3>
                <div class="space-y-3">
                    <div class="p-4 border border-dashed border-gray-200 rounded-2xl flex flex-col items-center justify-center text-center group hover:border-[#6366F1] transition-colors cursor-pointer">
                        <i class="bi bi-cloud-arrow-up text-2xl text-gray-300 mb-2 group-hover:text-[#6366F1] transition-colors"></i>
                        <p class="text-xs font-bold text-gray-500">Upload CV / Resume</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Update Modal -->
<div id="statusModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen p-4 text-center">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeModal('statusModal')"></div>
        <div class="relative bg-white rounded-[2rem] shadow-2xl w-full max-w-md overflow-hidden transform transition-all text-left">
            <div class="px-8 py-10 text-white" style="background: linear-gradient(to right, {{ accent_color or '#3B82F6' }}, #1F2937);">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-2xl font-black mb-1">Update Status</h3>
                        <p class="text-white/60 font-medium text-sm italic">Move candidate to the next stage.</p>
                    </div>
                    <button onclick="closeModal('statusModal')" class="text-white/60 hover:text-white transition-colors">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            </div>
            <form action="{{ url_for('hr1.update_applicant_status', id=applicant.id) }}" method="POST" class="p-8 space-y-6">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="space-y-4">
                    {% for s in ['Screening', 'Interview', 'Offer', 'Rejected'] %}
                    <label class="flex items-center p-4 rounded-2xl border border-gray-100 hover:bg-gray-50 cursor-pointer transition-all group">
                        <input type="radio" name="status" value="{{ s }}" {% if applicant.status == s %}checked{% endif %} class="w-5 h-5 border-gray-300 focus:ring-0" style="color: {{ accent_color or '#3B82F6' }};">
                        <span class="ml-4 font-bold text-gray-700 transition-colors">{{ s }}</span>
                    </label>
                    {% endfor %}
                </div>
                <div class="pt-4 flex space-x-3">
                    <button type="button" onclick="closeModal('statusModal')" class="flex-1 py-4 text-gray-400 font-bold hover:text-gray-600 transition-colors">Cancel</button>
                    <button type="submit" class="flex-1 py-4 text-white font-black rounded-2xl shadow-lg hover:scale-[1.02] transition-all" style="background: linear-gradient(to right, {{ accent_color or '#3B82F6' }}, #1F2937);">Update Status</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Handoff to HR2 Modal -->
<div id="handoffModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen p-4 text-center">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeModal('handoffModal')"></div>
        <div class="relative bg-white rounded-[2rem] shadow-2xl w-full max-w-md overflow-hidden transform transition-all text-left">
            <div class="px-8 py-10 text-white" style="background: linear-gradient(to right, #059669, #1F2937);">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-2xl font-black mb-1">Handoff to HR2</h3>
                        <p class="text-green-100/60 font-medium text-sm italic">Initiate onboarding for this candidate.</p>
                    </div>
                    <button onclick="closeModal('handoffModal')" class="text-white/60 hover:text-white transition-colors">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            </div>
            <form action="{{ url_for('hr1.handoff_hr2', id=applicant.id) }}" method="POST" class="p-8 space-y-6">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <div class="p-4 bg-green-50 border border-green-100 rounded-2xl">
                    <p class="text-sm text-green-700 leading-relaxed">
                        <i class="bi bi-info-circle-fill mr-2"></i>
                        Ready to onboard <b>{{ applicant.first_name }}</b>? This will create an onboarding record in HR2 and update the applicant status to Hired.
                    </p>
                </div>

                <div class="pt-4 flex space-x-3">
                    <button type="button" onclick="closeModal('handoffModal')" class="flex-1 py-4 text-gray-400 font-bold hover:text-gray-600 transition-colors">Cancel</button>
                    <button type="submit" class="flex-1 py-4 bg-green-600 text-white font-black rounded-2xl shadow-lg hover:bg-green-700 transition-all">Confirm Handoff</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function openModal(id) {
    document.getElementById(id).classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}
function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
    document.body.style.overflow = 'auto';
}
</script>
{% endblock %}
