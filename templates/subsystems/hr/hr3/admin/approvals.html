{% extends "base/base.html" %}

{% block title %}Pending Approvals - {{ subsystem_name }}{% endblock %}

{% block content %}
<div class="flex h-screen bg-gray-50 overflow-hidden font-sans">
    <!-- Sidebar -->
    <aside class="w-72 bg-white shadow-2xl hidden md:flex flex-col z-20 border-r border-gray-100">
        <div class="h-20 flex items-center px-8 border-b border-gray-100">
            <div
                class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#0EA5E9] to-gray-800 flex items-center justify-center shadow-lg mr-4 text-white">
                <i class="bi bi-clock-history text-lg"></i>
            </div>
            <div>
                <h1 class="text-xl font-extrabold text-gray-900 tracking-tight">HR3</h1>
                <p class="text-xs font-medium text-gray-400 uppercase tracking-wider">System</p>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-2">
            <p class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Main Menu</p>

            <a href="{{ url_for('hr3.dashboard') }}"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-xl transition-all duration-200 font-medium group">
                <i
                    class="bi bi-speedometer2 text-xl mr-3 text-gray-400 group-hover:text-[#0EA5E9] transition-colors"></i>
                Dashboard
            </a>

            <a href="#"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-xl transition-all duration-200 font-medium group">
                <i class="bi bi-people text-xl mr-3 text-gray-400 group-hover:text-[#0EA5E9] transition-colors"></i>
                Personnel
            </a>

            <a href="#"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-xl transition-all duration-200 font-medium group">
                <i
                    class="bi bi-file-earmark-text text-xl mr-3 text-gray-400 group-hover:text-[#0EA5E9] transition-colors"></i>
                Reports
            </a>

            {% if current_user.role in ['Admin', 'Administrator'] and current_user.subsystem == 'hr3' %}
            <p class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2">Administration</p>

            <a href="{{ url_for('hr3.pending_approvals') }}"
                class="flex items-center px-4 py-3 bg-[#0EA5E9]/10 text-[#0EA5E9] rounded-xl transition-all duration-200 font-bold group shadow-sm">
                <i class="bi bi-person-check text-xl mr-3 group-hover:scale-110 transition-transform"></i>
                Pending Approvals
                {% if users|length > 0 %}
                <span class="ml-auto bg-amber-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">{{ users|length
                    }}</span>
                {% endif %}
            </a>

            <a href="{{ url_for('hr3.user_list') }}"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-xl transition-all duration-200 font-medium group">
                <i
                    class="bi bi-people-fill text-xl mr-3 text-gray-400 group-hover:text-[#0EA5E9] transition-colors"></i>
                User Directory
            </a>
            {% endif %}

            <p class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2">System</p>

            <a href="#"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-xl transition-all duration-200 font-medium group">
                <i class="bi bi-gear text-xl mr-3 text-gray-400 group-hover:text-[#0EA5E9] transition-colors"></i>
                Settings
            </a>
        </nav>

        <div class="p-4 border-t border-gray-100 bg-gray-50/50">
            <div class="flex items-center mb-4 p-3 bg-white rounded-xl border border-gray-100 shadow-sm">
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-white font-bold shadow-md">
                    {{ current_user.username[0] | upper }}
                </div>
                <div class="ml-3 overflow-hidden">
                    <p class="text-sm font-bold text-gray-900 truncate">{{ current_user.username }}</p>
                    <p class="text-xs text-gray-500 truncate">{{ current_user.role }}</p>
                </div>
            </div>
            <a href="{{ url_for('hr3.logout') }}"
                class="flex items-center justify-center w-full px-4 py-2.5 text-sm font-bold text-red-600 bg-red-50 rounded-xl hover:bg-red-100 transition-all duration-200 hover:shadow-md">
                <i class="bi bi-box-arrow-right mr-2"></i> Sign Out
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden relative">
        <!-- Top Header -->
        <header
            class="bg-white/80 backdrop-blur-md shadow-sm h-20 flex items-center justify-between px-8 sticky top-0 z-10 border-b border-gray-100">
            <div class="flex items-center">
                <h2 class="text-2xl font-bold text-gray-800 tracking-tight">Pending Approvals</h2>
                <span class="ml-3 text-sm text-gray-500">All Departments</span>
            </div>
            <div class="flex items-center space-x-4">
                <a href="{{ url_for('hr3.user_list') }}"
                    class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium text-sm transition-colors">
                    View All Users
                </a>
            </div>
        </header>

        <!-- Content Scroll Area -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-8">
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="mb-6 space-y-3">
                {% for category, message in messages %}
                <div class="p-4 rounded-xl flex items-center gap-3
                    {% if category == 'success' %}bg-emerald-50 border border-emerald-200 text-emerald-700
                    {% elif category == 'danger' %}bg-red-50 border border-red-200 text-red-700
                    {% elif category == 'warning' %}bg-amber-50 border border-amber-200 text-amber-700
                    {% else %}bg-blue-50 border border-blue-200 text-blue-700{% endif %}">
                    {% if category == 'success' %}
                    <i class="bi bi-check-circle-fill"></i>
                    {% elif category == 'danger' %}
                    <i class="bi bi-x-circle-fill"></i>
                    {% elif category == 'warning' %}
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    {% else %}
                    <i class="bi bi-info-circle-fill"></i>
                    {% endif %}
                    <span class="font-medium">{{ message }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Stats Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Pending Requests</p>
                            <p class="text-3xl font-bold text-amber-500">{{ users|length }}</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-amber-50 flex items-center justify-center">
                            <i class="bi bi-clock text-xl text-amber-500"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Approved Today</p>
                            <p class="text-3xl font-bold text-emerald-500">0</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-emerald-50 flex items-center justify-center">
                            <i class="bi bi-check-lg text-xl text-emerald-500"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Denied Today</p>
                            <p class="text-3xl font-bold text-red-500">0</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-red-50 flex items-center justify-center">
                            <i class="bi bi-x-lg text-xl text-red-500"></i>
                        </div>
                    </div>
                </div>
            </div>

            {% if users %}
            <!-- Pending Users List -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                    <h3 class="font-bold text-gray-900">Registration Requests from All Departments</h3>
                </div>
                <div class="divide-y divide-gray-100">
                    {% for user in users %}
                    <div class="p-6 flex items-center justify-between hover:bg-gray-50 transition-colors">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-[#0EA5E9] to-gray-600 flex items-center justify-center text-white font-bold text-lg shadow-md">
                                {{ user.username[0]|upper }}
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900">{{ user.username }}</h4>
                                <p class="text-sm text-gray-500">{{ user.email }}</p>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <!-- Color-coded subsystem badge -->
                                    {% if 'hr' in user.subsystem|lower %}
                                    <span
                                        class="px-2.5 py-1 rounded-lg bg-blue-100 text-[10px] font-bold text-blue-700 uppercase tracking-wider border border-blue-200">
                                        <i class="bi bi-people-fill mr-1"></i>{{ user.subsystem|upper }}
                                    </span>
                                    {% elif 'ct' in user.subsystem|lower or 'core' in user.subsystem|lower %}
                                    <span
                                        class="px-2.5 py-1 rounded-lg bg-emerald-100 text-[10px] font-bold text-emerald-700 uppercase tracking-wider border border-emerald-200">
                                        <i class="bi bi-arrows-fullscreen mr-1"></i>{{ user.subsystem|upper }}
                                    </span>
                                    {% elif 'fin' in user.subsystem|lower %}
                                    <span
                                        class="px-2.5 py-1 rounded-lg bg-amber-100 text-[10px] font-bold text-amber-700 uppercase tracking-wider border border-amber-200">
                                        <i class="bi bi-currency-dollar mr-1"></i>{{ user.subsystem|upper }}
                                    </span>
                                    {% elif 'log' in user.subsystem|lower %}
                                    <span
                                        class="px-2.5 py-1 rounded-lg bg-purple-100 text-[10px] font-bold text-purple-700 uppercase tracking-wider border border-purple-200">
                                        <i class="bi bi-truck mr-1"></i>{{ user.subsystem|upper }}
                                    </span>
                                    {% else %}
                                    <span
                                        class="px-2.5 py-1 rounded-lg bg-gray-100 text-[10px] font-bold text-gray-700 uppercase tracking-wider border border-gray-200">
                                        {{ user.subsystem|upper }}
                                    </span>
                                    {% endif %}
                                    <span
                                        class="px-2 py-1 rounded-lg bg-gray-50 text-[10px] font-medium text-gray-500 uppercase tracking-wider border border-gray-200">
                                        {{ user.department }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center gap-6">
                            <div class="text-right hidden lg:block">
                                <p class="text-xs text-gray-400 uppercase tracking-widest font-bold">Registered</p>
                                <p class="text-sm text-gray-600">{{ user.created_at.strftime('%b %d, %Y') if
                                    user.created_at else 'N/A' }}</p>
                            </div>

                            <div class="flex gap-2">
                                <a href="{{ url_for('hr3.process_approval', user_id=user.id, action='deny') }}"
                                    onclick="return confirm('Are you sure you want to DENY this registration for {{ user.username }}?')"
                                    class="flex items-center gap-2 px-4 py-2.5 bg-red-50 text-red-600 hover:bg-red-500 hover:text-white rounded-xl transition-all font-medium text-sm border border-red-100 hover:border-red-500">
                                    <i class="bi bi-x-lg"></i>
                                    <span class="hidden sm:inline">Deny</span>
                                </a>
                                <a href="{{ url_for('hr3.process_approval', user_id=user.id, action='approve') }}"
                                    onclick="return confirm('Are you sure you want to APPROVE this registration for {{ user.username }}?')"
                                    class="flex items-center gap-2 px-4 py-2.5 bg-emerald-50 text-emerald-600 hover:bg-emerald-500 hover:text-white rounded-xl transition-all font-medium text-sm border border-emerald-100 hover:border-emerald-500">
                                    <i class="bi bi-check-lg"></i>
                                    <span class="hidden sm:inline">Approve</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- Empty State -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-16 text-center">
                <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="bi bi-check-circle text-4xl text-emerald-500"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">All Caught Up!</h3>
                <p class="text-gray-500 max-w-md mx-auto">There are no pending registration requests from any department
                    at this time. All submissions have been processed.</p>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}