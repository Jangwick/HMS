{% extends "base/subsystem_base.html" %}

{% block title %}Dashboard - {{ subsystem_name }}{% endblock %}
{% block header_title %}Workforce Operations{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Welcome Card -->
    <div class="rounded-3xl shadow-xl p-8 text-white relative overflow-hidden"
         style="background: linear-gradient(to right, {{ accent_color or '#4F46E5' }}, #1F2937);">
        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full transform translate-x-1/2 -translate-y-1/2 blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-black opacity-10 rounded-full transform -translate-x-1/2 translate-y-1/2 blur-2xl"></div>

        <div class="relative z-10">
            <h3 class="responsive-h3 mb-2">Welcome back, {{ current_user.username }}!</h3>
            <p class="text-white/80 text-base md:text-lg max-w-2xl">Manage workforce attendance, leave requests, and system-wide user coordination.</p>

            <div class="welcome-card-actions">
                <a href="{{ url_for('hr3.pending_approvals') }}"
                    class="px-6 py-3 bg-white font-bold rounded-xl shadow-lg hover:bg-gray-50 transition-colors text-center inline-flex items-center justify-center"
                    style="color: {{ accent_color or '#4F46E5' }};">
                    Pending Approvals
                </a>
                <a href="{{ url_for('hr3.analytics') }}"
                    class="px-6 py-3 bg-black/20 text-white font-bold rounded-xl hover:bg-black/30 transition-colors backdrop-blur-sm text-center inline-flex items-center justify-center">
                    System Analytics
                </a>
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h4 class="text-gray-500 text-sm font-bold uppercase tracking-wider">Active Employees</h4>
                <div class="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600">
                    <i class="bi bi-person-check"></i>
                </div>
            </div>
            <p class="text-3xl font-bold text-gray-900">{{ active_count }}</p>
            <p class="text-indigo-500 text-sm font-medium mt-2">Active accounts</p>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h4 class="text-gray-500 text-sm font-bold uppercase tracking-wider">Awaiting Approval</h4>
                <div class="w-10 h-10 rounded-full bg-amber-50 flex items-center justify-center text-amber-600">
                    <i class="bi bi-hourglass-split"></i>
                </div>
            </div>
            <p class="text-3xl font-bold text-gray-900">{{ pending_count }}</p>
            <p class="text-amber-500 text-sm font-medium mt-2">Review required</p>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h4 class="text-gray-500 text-sm font-bold uppercase tracking-wider">Today's Attendance</h4>
                <div class="w-10 h-10 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600">
                    <i class="bi bi-clock-history"></i>
                </div>
            </div>
            <p class="text-3xl font-bold text-gray-900">{{ today_attendance }}</p>
            <p class="text-emerald-500 text-sm font-medium mt-2">Staff clocked in</p>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h4 class="text-gray-500 text-sm font-bold uppercase tracking-wider">Open Leaves</h4>
                <div class="w-10 h-10 rounded-full bg-rose-50 flex items-center justify-center text-rose-600">
                    <i class="bi bi-calendar-minus"></i>
                </div>
            </div>
            <p class="text-3xl font-bold text-gray-900">{{ pending_leaves }}</p>
            <p class="text-rose-500 text-sm font-medium mt-2">Pending requests</p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Leave Requests -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-8">
            <div class="flex items-center justify-between mb-8">
                <h4 class="text-xl font-bold text-gray-900">Recent Leave Requests</h4>
                <a href="{{ url_for('hr3.list_leaves') }}" class="text-[#4F46E5] text-sm font-bold hover:underline">View All</a>
            </div>
            <div class="space-y-4">
                {% for leave in recent_leaves %}
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-xl bg-white flex items-center justify-center text-[#4F46E5] font-bold shadow-sm mr-4 text-xs">
                            LEAVE
                        </div>
                        <div>
                            <p class="font-bold text-gray-900">{{ leave.users.username }}</p>
                            <p class="text-xs text-gray-400">{{ leave.leave_type }} | {{ leave.start_date }}</p>
                        </div>
                    </div>
                    <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-amber-50 text-amber-600 uppercase">
                        {{ leave.status }}
                    </span>
                </div>
                {% else %}
                <div class="text-center py-10">
                    <p class="text-gray-400 font-medium">No recent leave requests.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Admin Actions -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-8">
            <h4 class="text-xl font-bold text-gray-900 mb-6">Workforce Actions</h4>
            <div class="grid grid-cols-2 gap-4">
                <a href="{{ url_for('hr3.add_user') }}" class="p-6 bg-indigo-50 rounded-2xl hover:bg-indigo-100 transition-colors group">
                    <i class="bi bi-person-plus text-2xl text-indigo-600 mb-2 block"></i>
                    <span class="font-bold text-indigo-900">Add New Staff</span>
                </a>
                <a href="{{ url_for('hr3.user_list') }}" class="p-6 bg-blue-50 rounded-2xl hover:bg-blue-100 transition-colors group">
                    <i class="bi bi-people text-2xl text-blue-600 mb-2 block"></i>
                    <span class="font-bold text-blue-900">User Directory</span>
                </a>
                <a href="{{ url_for('hr3.pending_approvals') }}" class="p-6 bg-emerald-50 rounded-2xl hover:bg-emerald-100 transition-colors group">
                    <i class="bi bi-check2-square text-2xl text-emerald-600 mb-2 block"></i>
                    <span class="font-bold text-emerald-900">Approvals</span>
                </a>
                <a href="{{ url_for('hr3.analytics') }}" class="p-6 bg-rose-50 rounded-2xl hover:bg-rose-100 transition-colors group">
                    <i class="bi bi-graph-up-arrow text-2xl text-rose-600 mb-2 block"></i>
                    <span class="font-bold text-rose-900">Operations Analytics</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Tasks Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Attendance Control -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden flex flex-col">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between bg-gray-50/50">
                <div class="flex items-center gap-4">
                    <h4 class="font-bold text-gray-900 flex items-center">
                        <i class="bi bi-clock-fill mr-2 text-accent"></i>
                        Staff Attendance
                    </h4>
                    <a href="{{ url_for('hr3.list_attendance') }}" class="text-[#4F46E5] text-xs font-bold hover:underline">View All</a>
                </div>
                <div id="current-time" class="text-sm font-mono font-bold text-accent bg-accent/10 px-3 py-1 rounded-lg"></div>
            </div>
            <div class="p-8 flex-1 flex flex-col justify-center">
                {% if is_clocked_in %}
                <div class="mb-6 flex items-center p-4 bg-green-50 rounded-2xl border border-green-100">
                    <div class="w-12 h-12 rounded-xl bg-green-500 text-white flex items-center justify-center shadow-lg mr-4">
                        <i class="bi bi-person-walking text-xl"></i>
                    </div>
                    <div>
                        <p class="font-bold text-green-900">Currently Clocked In</p>
                        <p class="text-sm text-green-700/70">Started at {{ current_log.clock_in|datetime }}</p>
                    </div>
                </div>
                <form action="{{ url_for('hr3.clock_out') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="w-full py-4 bg-rose-500 hover:bg-rose-600 text-white font-bold rounded-2xl shadow-lg shadow-rose-200 transition-all flex items-center justify-center">
                        <i class="bi bi-box-arrow-right mr-2"></i> Clock Out Now
                    </button>
                </form>
                {% else %}
                <div class="mb-6 flex items-center p-4 bg-gray-50 rounded-2xl border border-gray-100">
                    <div class="w-12 h-12 rounded-xl bg-gray-200 text-gray-400 flex items-center justify-center mr-4">
                        <i class="bi bi-door-closed text-xl"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-600">Not Clocked In</p>
                        <p class="text-sm text-gray-400">Ready to start your shift?</p>
                    </div>
                </div>
                <form action="{{ url_for('hr3.clock_in') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="w-full py-4 bg-accent hover:opacity-90 text-white font-bold rounded-2xl shadow-lg shadow-accent/20 transition-all flex items-center justify-center">
                        <i class="bi bi-fingerprint mr-2"></i> Clock In Now
                    </button>
                </form>
                {% endif %}
            </div>
        </div>

        <!-- Leave Actions -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden flex flex-col">
            <div class="p-6 border-b border-gray-100 bg-gray-50/50">
                <h4 class="font-bold text-gray-900 flex items-center">
                    <i class="bi bi-calendar-event-fill mr-2 text-indigo-500"></i>
                    Leave Management
                </h4>
            </div>
            <div class="p-4 space-y-3">
                <a href="{{ url_for('hr3.request_leave') }}" class="flex items-center p-4 hover:bg-indigo-50 rounded-2xl transition-all border border-transparent hover:border-indigo-100 group">
                    <div class="w-12 h-12 rounded-xl bg-indigo-50 text-indigo-600 flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-all mr-4">
                        <i class="bi bi-plus-lg text-xl"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-900">New Leave Request</p>
                        <p class="text-sm text-gray-400">Submit a new application</p>
                    </div>
                    <i class="bi bi-chevron-right ml-auto text-gray-300"></i>
                </a>
                <a href="{{ url_for('hr3.list_leaves') }}" class="flex items-center p-4 hover:bg-slate-50 rounded-2xl transition-all border border-transparent hover:border-slate-100 group">
                    <div class="w-12 h-12 rounded-xl bg-slate-50 text-slate-600 flex items-center justify-center group-hover:bg-slate-600 group-hover:text-white transition-all mr-4">
                        <i class="bi bi-history text-xl"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-900">Leave History</p>
                        <p class="text-sm text-gray-400">View previous requests</p>
                    </div>
                    <i class="bi bi-chevron-right ml-auto text-gray-300"></i>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<script>
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        const timeElement = document.getElementById('current-time');
        if (timeElement) {
            timeElement.textContent = timeString;
        }
    }
    setInterval(updateClock, 1000);
    updateClock();
</script>